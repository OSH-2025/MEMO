# 实现软件系统调用

## 目录
- [实现软件系统调用](#实现软件系统调用)
  - [目录](#目录)
  - [实现背景](#实现背景)
    - [与星期的关联性](#与星期的关联性)
    - [纠错机制](#纠错机制)
  - [实现原理](#实现原理)
  - [核心代码](#核心代码)
  - [实现流程](#实现流程)
- [References](#references)

## 实现背景

### 与星期的关联性

根据个人的PC使用偏好，我们认为PC软件的使用时间与星期呈现较大的相关性。对于学生和老师而言，由于课程的安排规划常常按照课程表（按照周为单位）进行。因此，他们的PC软件使用情况理应与星期呈现较大的关联性。这一发现不仅仅适用于师生群体。一项发表于PLOS ONE的研究分析了美国得克萨斯州一家大型能源公司789名办公室员工在两年内的电脑使用数据。研究发现：

1. 工作量在一个星期内逐日增加：从周一到周四，员工的电脑使用量（包括打字数量、鼠标点击和滚动）逐渐增加。

2. 周五显著下降：到了周五，尤其是下午，电脑使用量显著减少，打字数量下降了约19%，而打字错误仅减少了1.65%，表明工作效率下降。

这些结果表明，员工在一周的不同工作日中，电脑使用模式存在显著差异，可能受到心理和行为因素的影响。[1] 根据对自身行为的理解以及如上相关研究，我们打算以星期为单位对用户的软件使用进行预测，从而提高预测的准确率。


### 纠错机制
我们在使用中发现，预测失败的惩罚力度较高。首先，站在操作系统的维度，错误的预测会导致不需要执行的程序占用处理器及内存，是一种极大的资源浪费。由于错误的程序占用系统资源，处理器需要把这些程序再调出内存，增加了上下文转换的工作量。在预测不精确的情况下也会为系统带来不菲的开销。

因此我们提出了一种**提前纠错机制**。首先，如果预测结果显示在某时刻应该启用某软件时，在启用软件之前，我们会先询问用户是否需要启动该软件。如果用户同意，那么正常起启动该软件；如果用户不同意，那么不启用该软件，同时会将这一启动操作在启动队列中对应的表项删除。这表示用户认为预测失败，或者认为与自己的使用需求不相符。通过这样的方式，可以实现对预测结果与用户需求的综合考量，在极大程度上优化了用户的体验感。

## 实现原理
微调的预测结果会被写入prediction_results.csv中，而根据星期为周期的预测结果将会被写入prediction_buffer.csv中。系统调用程序将根据prediction_buffer.csv中的预测结果来执行。prediction_buffer.csv相当于一个在预测和执行中间的缓冲区，给缓冲区的内容对用户是透明的，但是直接的预测结果（prediction_results.csv）对用户不透明。

对于buffer的填充原理，我们采用预测即填充的方式，即根据用户一个周期的使用情况结果会根据用户使用数据的更新不断被写入至这一buffer中。

对于buffer的删除原理，我们考虑了用户的实际使用需求。在系统调用前，我们会提醒用户根据预测结果，有某软件需要被启用，并询问它的需求。如果用户拒绝该请求，不仅这一预测结果不会被执行，它同时会从prediction_buffer.csv中被删除。这样<span style="color:red;">从一定程度上降低了预测失败的惩罚，同时优化了用户的体验。</span>

## 核心代码
1. 解析prediction_buffer.csv中的内容
![alt text](/final_report/asset/parse.png)

根据预测的条件，我们将prediction_buffer.csv中的条目解析成4个部分。type分成apps和urls两类，分别表示应用和网页。weekday即是启动的星期，time是启用的具体的时间，target对于应用来说是启用的路径，对于网页来说是相应的网址。

1. 预测结果调用前判断
![alt text](/final_report/asset/call.png)
如果星期和时间都对应相等，则会启用相应的软件或者网址。

1. 启动程序/网页
![alt text](/final_report/asset/launch.png)

根据网页或者程序类型的不同，启动网页或者程序。
1. 主循环
![alt text](/final_report/asset/circle.png)

预测程序启用即进入主循环。首先从buffer中不断读取entries；然后解析该entry，提取出对应的时间、路径的网址。如果判断需要启动该程序，则让用户进行选择是否需要启动。如果用户点击yes，则启动该程序，同时把该条目加入updated_entries；如果用户点击no，则不把这一条目加入updated entries。如果还没有到启用时间，则无论如何将这一条目加入到updated entries。这样即实现了模拟删除的过程。

## 实现流程

5.29 我们准备以一星期为周期进行软件预测，我们打算收集一星期之内的用户软件使用情况，并按照这一星期之内的用户数据使用情况预测下一星期的用户软件使用情况。<span style="color:red;">目前，我们已经实现了在给定时间下实现软件的成功预测和互联网网站的成功预测!</span>
![成功启用](/final_report/asset/image.png)

6.28 我们实现了从prediction_buffer.csv中读取条目的程序，并且能够根据用户需求重写prediction_buffer.csv，并绘制相应的图形界面。
1. 启动应用程序
![alt text](/final_report/asset/setup.png)
2. 询问用户
![alt text](/final_report/asset/customer.png)

# References
1. Roh, T., Esomonu, C., Hendricks, J., Aggarwal, A., Hasan, N. T., & Benden, M. (2023).  **Examining workweek variations in computer usage patterns: An application of ergonomic monitoring software.**  *PLOS ONE*, 18(7), e0287976. https://doi.org/10.1371/journal.pone.0287976
