# 用户行为预测系统

该项目用于收集和分析用户的文件操作及应用使用行为，生成大语言模型可学习的数据集，以预测用户未来可能的操作。

## 项目结构

- `activity_monitor.py` - 监控和收集用户活动数据
- `activity_analyzer.py` - 分析收集的数据并生成训练数据集
- `activity_data/` - 存储收集的活动数据
- `dataset/` - 存储生成的数据集

## 功能特点

### 收集的用户活动类型

- **窗口焦点变化** - 记录用户切换的应用窗口
- **进程启动和结束** - 记录用户启动和关闭的应用程序，包含进程名和路径
- **浏览器历史** - 记录用户访问的网页（已过滤敏感信息）
- **文件访问** - 记录用户打开的文件

### 噪音过滤

系统针对用户活动数据实现了以下噪音过滤机制：

1. **窗口焦点变化** - 过滤过于频繁的窗口切换（小于2秒的间隔）
2. **进程监控** - 仅记录用户进程，过滤系统进程和后台服务
3. **浏览器历史** - 仅记录有意义的网页访问，过滤扩展页面和新标签页
4. **文件访问** - 避免记录重复的文件操作（同一文件至少间隔5秒）

### 隐私保护措施

系统设计考虑了隐私保护，主要体现在：

1. 不收集密码、登录凭证等敏感信息
2. 浏览器历史中过滤包含敏感关键词的URL
3. 不记录系统进程和后台服务
4. 数据保存在本地，不会上传到外部服务器

## 系统需求

### 依赖项

```
python >= 3.8
psutil
pywin32
pandas
numpy
matplotlib
seaborn
```

可以通过以下命令安装依赖：

```bash
pip install psutil pywin32 pandas numpy matplotlib seaborn
```

### 兼容性

- Windows 10/11

## 使用方法

### 收集活动数据

1. 运行监控脚本开始收集用户活动数据：

```bash
python activity_monitor.py
```

2. 脚本会在后台运行，收集用户活动。按 `Ctrl+C` 停止收集。
3. 收集的数据将保存在 `activity_data` 目录下，每5分钟自动保存一次。

### 分析数据并生成数据集

在收集足够的活动数据后，运行分析脚本来处理数据并生成训练数据集：

```bash
python activity_analyzer.py --visualize
```

可选参数：

- `--data-dir`: 指定活动数据目录（默认：`activity_data`）
- `--output-dir`: 指定输出数据集目录（默认：`dataset`）
- `--window-size`: 预测窗口大小（默认：5）
- `--step-size`: 滑动窗口步长（默认：1）
- `--inactive-threshold`: 会话不活跃阈值（分钟，默认：30）
- `--export-format`: 微调数据集格式，可选 "alpaca" 或 "instruct"（默认："alpaca"）
- `--visualize`: 添加此参数生成活动模式可视化图表

### 生成的数据集

分析脚本会生成以下文件：

1. `activity_analysis.json` - 活动模式分析结果
2. `activity_prediction_dataset.json` - 用于预测的数据集
3. `alpaca_fine_tuning_data.json` 或 `instruct_fine_tuning_data.jsonl` - 用于微调大语言模型的数据集

## 数据流程

1. **收集阶段** - `activity_monitor.py` 持续监控用户活动并保存为JSON文件
2. **预处理阶段** - `activity_analyzer.py` 加载并清洗收集到的数据
3. **分段阶段** - 将活动数据按用户会话或时间窗口分段
4. **分析阶段** - 识别活动模式和规律
5. **数据集生成阶段** - 创建用于训练预测模型的输入-输出对

## 微调大语言模型

生成的微调数据集可用于训练大语言模型，以预测用户未来的操作。支持两种格式：

1. **Alpaca格式** - 适用于基于指令的微调
2. **Instruct格式** - 适用于对话式模型（如ChatGPT）的微调

## 实现应用场景

通过微调后的预测模型，可以实现以下应用场景：

1. 智能桌面助手 - 预测并自动启动用户可能需要的应用
2. 智能文件推荐 - 根据上下文预测用户可能需要打开的文件
3. 工作流优化 - 识别用户常用的操作序列，提供快捷方式
4. 效率提升 - 减少重复操作，提前准备用户可能需要的资源

## 扩展和定制

如需扩展系统功能，可以修改以下部分：

1. `ActivityMonitor` 类中添加新的活动类型监控
2. `ActivityAnalyzer` 类中增强数据分析能力
3. 定制数据集格式以适应不同的模型训练需求

## 注意事项

- 长时间运行监控脚本可能会占用一定系统资源
- 确保有足够的磁盘空间存储收集的数据
- 建议在个人计算机上使用，不要在共享设备上收集活动数据

## Future Work

以下是未来可能的改进方向：

### 噪音过滤增强

1. **意图识别** - 开发更智能的算法来区分用户的有意操作和无意操作
   - 实现基于时间间隔和操作上下文的意图识别
   - 过滤掉快速在不同窗口间切换但未实际使用的"飘过"行为

2. **操作聚合** - 将细粒度操作聚合为更有意义的行为单元
   - 例如，将连续的文件保存操作合并为一个编辑会话
   - 识别反复编辑同一文档的模式，而不是记录每次细微变化

3. **关注度分析** - 结合操作持续时间评估用户关注度
   - 记录窗口保持活跃的时长，而不仅仅是激活事件
   - 区分有效工作时间和被动浏览时间

### 数据精细化

1. **文件内容感知** - 安全地提取文件上下文信息
   - 记录文件类型、大小、修改频率等元数据
   - 可选择性地索引文档标题或关键词，以增强语义理解

2. **应用细粒度操作** - 记录应用内的特定操作
   - 通过辅助功能API或应用插件获取应用内操作
   - 区分读取和编辑操作

3. **时间敏感模式** - 识别与时间相关的活动模式
   - 分析工作日与周末的行为差异
   - 识别早晨、中午和晚上的不同活动习惯

### 交互性增强

1. **反馈机制** - 允许用户对错误预测进行反馈
   - 实现简单的反馈界面，让用户确认或否定预测
   - 基于用户反馈动态调整预测算法

2. **上下文感知** - 考虑物理和数字环境的上下文
   - 结合日历事件、邮件或即时消息等信息
   - 考虑位置信息（家庭/办公室）对行为模式的影响

这些改进将使系统能够更准确地识别有意义的用户操作，过滤掉噪音数据，提高预测模型的准确性和实用性。 