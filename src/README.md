# 用户行为预测系统 (MEMO)

这个系统用于收集和分析用户的文件操作和应用使用行为，生成可供大语言模型学习的数据集，以预测用户未来可能的操作。通过这种方式，系统可以提前加载用户可能会使用的应用程序或网页，提升用户体验。

## 系统概述

MEMO系统由两个主要组件组成：

1. **活动监控模块 (activity_monitor.py)** - 后台运行，实时收集用户的文件操作、应用使用、浏览器活动等数据。
2. **活动分析模块 (activity_analyzer.py)** - 处理收集到的数据，生成训练集，并分析用户行为模式。

## 数据收集的内容

系统收集以下类型的用户活动数据，同时注重隐私保护：

| 活动类型 | 收集的数据 | 不收集的数据 |
|--------|-----------|------------|
| **窗口焦点** | 窗口标题、应用名称、时间戳 | 窗口内的具体内容和用户输入 |
| **应用使用** | 应用名称、启动和关闭时间、使用时长 | 应用内的用户数据和操作细节 |
| **浏览器历史** | 访问的URL、页面标题、访问时间 | 登录凭证、表单数据、cookies |
| **文件访问** | 文件名、路径、访问时间、文件类型 | 文件内容和元数据 |
| **时间上下文** | 星期、小时、工作日/周末 | 用户的日历事件或具体活动计划 |

## 项目结构

```
MEMO/
├── activity_monitor.py      # 用户活动监控脚本
├── activity_analyzer.py     # 数据分析和训练集生成脚本
├── activity_data/           # 收集的原始活动数据
├── dataset/                 # 生成的训练数据集和分析结果
│   ├── activity_analysis.json         # 活动模式分析
│   ├── activity_prediction_dataset.json  # 预测数据集
│   ├── alpaca_fine_tuning_data.json     # 用于微调的数据
│   └── visualizations/                 # 活动模式可视化
└── requirements.txt         # 项目依赖项
```

## 安装与设置

### 依赖项

```bash
pip install -r requirements.txt
```

或手动安装以下依赖：

```bash
pip install psutil pywin32 pandas numpy matplotlib seaborn scikit-learn tqdm networkx
```

### 操作系统要求

- 系统主要为Windows设计，因为它依赖Windows特定的API来监控用户活动
- 支持Windows 10/11

## 使用方法

### 步骤1：收集用户活动数据

运行活动监控器开始收集数据：

```bash
python activity_monitor.py
```

监控器会在后台运行，默认每5分钟自动保存数据到`activity_data`目录。按`Ctrl+C`停止。

建议至少运行几天，以收集足够的行为数据，涵盖不同的使用模式和场景。

### 步骤2：分析数据并生成训练集

在收集了足够的数据后，运行分析脚本：

```bash
python activity_analyzer.py --visualize
```

常用参数：

- `--data-dir DIR` - 指定活动数据目录（默认：activity_data）
- `--output-dir DIR` - 指定输出目录（默认：dataset）
- `--window-size N` - 预测窗口大小，即使用N个历史活动预测下一个活动（默认：5）
- `--step-size N` - 滑动窗口步长，较大的步长可减少相似样本（默认：1）
- `--max-samples N` - 每个序列最多生成N个训练样本，避免长序列贡献过多数据（默认：5）
- `--no-dedup` - 禁用序列去重，默认会删除重复或高度相似的序列
- `--max-dataset-size N` - 限制最终数据集的最大样本数（默认：1000）
- `--visualize` - 生成可视化图表
- `--export-format FORMAT` - 指定微调数据格式，可选"alpaca"或"instruct"（默认：alpaca）

例如，要生成一个更多样化的较小数据集：

```bash
python activity_analyzer.py --window-size 8 --step-size 3 --max-samples 3 --max-dataset-size 500 --visualize
```

### 步骤3：查看分析结果

分析脚本生成的结果包括：

1. **活动模式分析** (`activity_analysis.json`) - 用户行为模式的概览
2. **预测数据集** (`activity_prediction_dataset.json`) - 序列预测数据集
3. **微调数据** (`alpaca_fine_tuning_data.json` 或 `instruct_fine_tuning_data.jsonl`) - 用于大语言模型微调的数据集
4. **可视化图表** (`dataset/visualizations/`) - 用户活动模式的可视化图表

## 数据格式

### 原始活动数据

活动监控器生成的JSON格式示例：

```json
[
  {
    "type": "window_focus",
    "window_title": "文档 - Microsoft Word",
    "process_name": "WINWORD.EXE",
    "executable_path": "C:\\Program Files\\Microsoft Office\\root\\Office16\\WINWORD.EXE",
    "timestamp": "2023-04-15T09:32:45.123456"
  },
  {
    "type": "browser_history",
    "browser": "chrome",
    "url": "https://www.example.com/article/12345",
    "title": "示例文章标题",
    "domain": "www.example.com",
    "timestamp": "2023-04-15T09:35:12.654321"
  }
]
```

### 训练数据集

生成的预测数据集格式示例：

```json
{
  "input_sequence": [
    "2023-04-15 09:32:45 - 切换到窗口: 文档 - Microsoft Word (应用: WINWORD.EXE)",
    "2023-04-15 09:35:12 - 访问网页: 示例文章标题 (https://www.example.com/article/12345)",
    "2023-04-15 09:40:23 - 访问文件: C:\\Users\\Username\\Documents\\report.docx",
    "2023-04-15 09:42:18 - 切换到窗口: 报表 - Microsoft Excel (应用: EXCEL.EXE)",
    "2023-04-15 09:45:30 - 访问文件: C:\\Users\\Username\\Documents\\data.xlsx"
  ],
  "target": "2023-04-15 09:48:12 - 切换到窗口: 演示文稿 - Microsoft PowerPoint (应用: POWERPNT.EXE)"
}
```

## 隐私保护

系统设计时考虑了隐私保护：

1. **所有数据存储在本地** - 不会上传到任何服务器
2. **敏感信息过滤** - 不收集密码、登录凭证等敏感信息
3. **URL过滤** - 过滤掉包含敏感关键词的URL（如登录、支付、账户等）
4. **系统进程过滤** - 不记录后台系统进程和服务

## 对大语言模型的微调

生成的数据集可以用于微调大语言模型，以提高其对用户行为的预测能力。系统支持两种微调格式：

1. **Alpaca格式** - 适合基于指令的微调（如Llama、Alpaca等模型）
2. **Instruct格式** - 适合对话式模型（如ChatGPT）的微调

微调后的模型可以根据用户的活动历史序列，预测下一个可能的活动，为智能助手或预加载系统提供基础。

## 应用场景

1. **智能桌面助手** - 预测并自动启动用户可能需要的应用
2. **智能浏览器** - 提前加载用户可能会访问的网页
3. **工作流自动化** - 识别重复操作序列，提供自动化建议
4. **资源优化** - 根据预测提前分配系统资源，提高响应速度

## 常见问题

**Q: 系统会消耗多少资源？**  
A: 活动监控器设计为轻量级运行，通常使用不到5%的CPU和50MB的内存。

**Q: 如何确保我的隐私数据不被收集？**  
A: 系统内置多层过滤机制，您也可以在`activity_monitor.py`中的`_should_filter_url`函数中添加更多过滤规则。

**Q: 数据会被上传到外部服务器吗？**  
A: 不会。所有数据都存储在本地的`activity_data`和`dataset`目录中。

**Q: 需要收集多长时间的数据？**  
A: 建议至少收集一周的数据，以便捕捉不同工作日和周末的行为模式。

## Future Work

### 数据收集增强

1. **更细粒度的应用内操作** - 通过辅助功能API或插件监控用户在特定应用中的操作
   - 例如：记录文档内的编辑、保存、格式化等操作
   - 记录特定应用中的菜单选择和功能使用

2. **多模态数据融合** - 结合各种用户行为数据源
   - 结合键盘和鼠标活动模式
   - 考虑系统状态（如电池电量、网络连接）与用户行为的关系

3. **上下文感知增强** - 收集更多环境和状态信息
   - 与日历和邮件等应用集成，获取更丰富的上下文
   - 收集设备位置和连接的网络类型
   
### 噪音过滤优化

1. **意图识别** - 开发更智能的算法区分有意操作和无意操作
   - 使用时序分析识别有意义的操作序列
   - 检测"飘过"行为（快速鼠标移动和点击但无实际互动）
   
2. **用户注意力模型** - 基于停留时间和交互强度评估用户注意力
   - 区分活跃使用和被动浏览
   - 量化窗口交互强度而非简单的焦点切换
   
3. **学习过滤器** - 基于用户反馈调整过滤规则
   - 允许用户标记误收集的数据
   - 自适应调整噪音阈值

### 高级数据分析

1. **行为聚类** - 识别不同的用户行为模式和工作上下文
   - 使用无监督学习区分工作模式、学习模式、娱乐模式等
   - 识别任务切换和上下文边界
   
2. **序列变形分析** - 识别相似但不完全相同的行为序列
   - 使用序列对齐算法发现变形的模式
   - 抽象出高级意图而非具体操作序列
   
3. **时序模式挖掘** - 识别时间依赖的行为模式
   - 分析随时间变化的行为习惯
   - 识别周期性模式和长期趋势

### 大语言模型微调

1. **差异化预测** - 针对不同时间尺度的预测优化模型
   - 短期（下一个操作）预测
   - 中期（接下来几分钟）预测
   - 长期（工作流程）预测
   
2. **小样本学习增强** - 优化模型在有限数据条件下的表现
   - 通过模拟数据增强真实用户数据
   - 实现快速适应新用户行为模式
   
3. **RAG优化** - 使用检索增强生成技术提高预测质量
   - 为模型提供更丰富的上下文检索
   - 结合用户特定的知识库和历史行为

### 交互优化

1. **反馈循环** - 允许用户评价预测质量
   - 收集用户对预测准确性的反馈
   - 动态调整模型参数和预测阈值
   
2. **渐进式上下文学习** - 随时间推移越来越了解用户
   - 构建个性化用户概况，捕捉长期兴趣和习惯
   - 基于真实世界事件和季节性因素调整预测

3. **多级预测** - 提供不同置信度的预测结果
   - 高置信度预测用于自动操作
   - 中等置信度预测用于建议
   - 低置信度预测用于探索性建议

通过这些改进，MEMO系统可以更好地理解和预测用户行为，为提供智能、个性化的用户体验奠定基础。 