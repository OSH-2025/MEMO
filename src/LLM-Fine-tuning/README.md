# 用户行为预测系统的大模型微调模块 (MEMO)

本模块用于大语言模型（LLM）的微调、评估与推理，并包含自动化模型下载、批量预测和结果分析等功能。

## 目录结构

```
LLM-Fine-tuning/
 ├── data/                         # 存放训练/验证用的json数据文件
 ├── download_model.py             # 下载大模型参数脚本
 ├── predict_and_dispatch_demo.py  # 批量预测与调度演示脚本
 ├── prediction_results.csv        # 验证集预测结果及分析
 ├── README.md                     # 项目说明文档
 ├── test.py                       # 单独测试微调后模型可用性的脚本
 ├── train.py                      # 大模型微调及准确度评估脚本
```

## 各文件功能说明

- **data/**  
  存放用于训练和验证的数据文件（如多个json样本）。

- **download_model.py**  
  自动下载所需的大模型参数文件并放置到指定目录，首次运行前请先执行本脚本。

- **train.py**  
  用于对指定的大语言模型进行微调训练，并在验证集上评估模型的准确性。会自动输出训练日志和验证结果。

- **test.py**  
  用于加载已微调好的模型，进行单条或批量推理测试，验证模型实际推理效果。

- **predict_and_dispatch_demo.py**  
  演示模型批量预测和调度任务的脚本，可用于生产场景或进一步集成。

- **prediction_results.csv**  
  保存模型在验证集上的预测结果、参考答案以及详细比对信息。

## 环境依赖

建议使用 Python 3.8+，推荐在虚拟环境下安装依赖。

请参考 `requirements.txt` 文件进行环境配置：

```bash
pip install -r requirements.txt
```

**主要依赖：**

- torch
- transformers
- datasets
- peft
- pandas
- numpy
- 及其它辅助库

## 快速开始

### 1. 下载大模型参数

```bash
python download_model.py
```

### 2. 准备训练数据

请将你的训练/验证数据（json文件）放入 `data/` 文件夹。

### 3. 微调模型

```bash
python train.py
```

模型训练完成后，会自动保存预测结果到 `prediction_results.csv`。

### 4. 单独测试微调后模型

```bash
python test.py
```

根据提示输入测试用例，即可获得模型预测输出。

### 5. 批量预测与调度（可选）

```bash
python predict_and_dispatch_demo.py
```

## 说明

- 推荐在 GPU 环境下运行以加速训练和推理。
- 若遇到 `index.lock` 错误，请参见 [Git 常见问题解决](https://github.com/) 相关说明。
- 如需自定义训练参数或模型路径，请修改 `train.py` 中的相关配置。

## 结果展示

### exp1 一人约10小时的数据集

```r
状态: 部分正确（操作和目标相同）

错误示例 4:
预测: 2025-05-27 20:58:33 - 切换到窗口: 2025.5 qq_crawler - JupyterLab (应用: msedge.exe)
参考: 2025-05-27 20:58:34 - 关闭应用: msedge.exe
状态: 不正确

错误示例 5:
预测: 2025-05-27 08:42:30 - 访问网站 github.com 的页面 'Repository search results'
参考: 2025-05-27 08:42:37 - 访问网站 github.com 的页面 'BeanWei/MusicSpider: :trollface: Music Spider. Go 👾 Music Spider 是使用Golang写的音乐聚合爬虫，目前支持的站点包
   网易、QQ、虾米、酷狗、百度。'
状态: 部分正确（操作和目标相同）

错误示例 6:
预测: 2025-05-27 09:03:08 - 访问网站 gitlab.com 的页面 'Help us keep GitLab secure · GitLab'
参考: 2025-05-27 09:03:28 - 访问网站 gitlab.com 的页面 'GitLab'
状态: 部分正确（操作和目标相同）

错误示例 7:
预测: 2025-05-27 11:20:53 - 访问网站 www.douban.com 的页面 '再就业自来水楼4.0'
参考: 2025-05-27 11:19:51 - 访问网站 www.douban.com 的页面 '再就业自来水楼4.0'
状态: 部分正确（操作和目标相同）

错误示例 8:
预测: 2025-05-27 11:19:54 - 访问网站 www.douban.com 的页面 '再就业自来水楼4.0'
参考: 2025-05-27 11:20:16 - 访问网站 www.douban.com 的页面 '再就业自来水楼4.0'
状态: 部分正确（操作和目标相同）

错误示例 9:
预测: 2025-05-27 11:20:16 - 访问网站 www.douban.com 的页面 '再就业自来水楼4.0'
参考: 2025-05-27 11:20:24 - 访问网站 www.douban.com 的页面 '☀️玄学记录·三'
状态: 部分正确（操作和目标相同）

错误示例 10:
预测: 2025-05-27 11:30:30 - 访问网站 www.douban.com 的页面 '歌手暴打芒果汁🍀梨汁赛高版升学考试宴会碎碎念'
参考: 2025-05-27 11:30:42 - 访问网站 www.douban.com 的页面 '我的小组讨论'
状态: 部分正确（操作和目标相同）

完全正确预测: 22/149 (0.1477)
部分正确预测: 45/149 (0.3020)
总体准确率: 0.2987 (完全正确+一半部分正确的权重)
验证集预测准确率: 0.1477
所有预测结果已保存到 prediction_results.csv
```

### exp2 两人共约20小时的数据集

```r
错误示例 4:
预测: 2025-05-28 16:02:27 - 启动应用: msedge.exe
参考: 2025-05-28 16:02:29 - 启动应用: msedge.exe
状态: 部分正确（操作和目标相同）

错误示例 5:
预测: 2025-05-28 08:07:00 - 启动应用: QQ.exe
参考: 2025-05-28 08:07:11 - 访问文件: CODH (位于 D:\25 spring)
状态: 不正确

错误示例 6:
预测: 2025-05-28 08:08:12 - 切换到窗口: 视频播放 - CODH 2025 和另外 1 个页面 - CeceliaYu - Microsoft​ Edge (应用: msedge.exe)
参考: 2025-05-28 08:08:12 - 启动应用: msedge.exe
状态: 不正确

错误示例 7:
预测: 2025-05-28 08:10:21 - 关闭应用: iverilog.exe
参考: 2025-05-28 08:10:21 - 关闭应用: cmd.exe
状态: 不正确

错误示例 8:
预测: 2025-05-28 08:10:47 - 关闭应用: msedge.exe
参考: 2025-05-28 08:11:53 - 关闭应用: QQ.exe
状态: 不正确

错误示例 9:
预测: 2025-05-28 08:13:10 - 关闭应用: msedge.exe
参考: 2025-05-28 08:13:27 - 关闭应用: msedge.exe
状态: 部分正确（操作和目标相同）

错误示例 10:
预测: 2025-05-28 08:21:11 - 关闭应用: chrome.exe
参考: 2025-05-28 08:21:09 - 使用应用: msedge.exe (时长: 5.26秒)
状态: 不正确

完全正确预测: 28/179 (0.1564)
部分正确预测: 53/179 (0.2961)
总体准确率: 0.3045 (完全正确+一半部分正确的权重)
验证集预测准确率: 0.1564
所有预测结果已保存到 prediction_results.csv
```

### exp3 三人三个数据集

```r
完全正确预测: 47/243 (0.1934)
部分正确预测: 70/243 (0.2881)
总体准确率: 0.3374 (完全正确+一半部分正确的权重)
验证集预测准确率: 0.1934
所有预测结果已保存到 prediction_results.csv
```